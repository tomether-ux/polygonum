{% extends 'scambi/base.html' %}
{% load static %}

{% block title %}Le Mie Catene - POLYGONUM{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1 class="display-4 fw-bold mb-4" style="font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif; color: #2c3e50;">ðŸ”— Le Mie Catene</h1>

        {% if total_catene == 0 %}
        <div class="alert alert-info">
            <i class="fas fa-info-circle me-2"></i>
            Non hai ancora mostrato interesse per nessuna catena di scambio.
            <br>
            <a href="{% url 'catene_scambio' %}?load=true" class="alert-link">Esplora le catene disponibili</a>
        </div>
        {% else %}
        <p class="text-muted mb-4">
            Hai mostrato interesse per <strong>{{ total_catene }}</strong> catena{{ total_catene|pluralize }}
        </p>

        <!-- Contenitore gruppi di catene -->
        <div class="chains-container">
            <!-- Gruppo 2 persone - Line -->
            {% if catene_2 %}
            <div class="chain-group mb-4">
                <button class="chain-group-header" onclick="toggleGroup('group-2')">
                    <div class="group-title">
                        <span class="group-icon">âž–</span>
                        <span class="group-name">Line</span>
                        <span class="group-description">2 persone</span>
                    </div>
                    <div class="group-meta">
                        <span class="group-count-badge">{{ catene_2|length }} catene</span>
                        <i class="fas fa-chevron-down chevron-icon"></i>
                    </div>
                </button>
                <div id="group-2" class="chain-group-content">
                    {% for catena in catene_2 %}
                    {% include "scambi/partials/mie_catene_card.html" %}
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Gruppo 3 persone - Triangle -->
            {% if catene_3 %}
            <div class="chain-group mb-4">
                <button class="chain-group-header" onclick="toggleGroup('group-3')">
                    <div class="group-title">
                        <span class="group-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 4 L20 20 L4 20 Z" stroke="#4169E1" stroke-width="2" fill="none" stroke-linejoin="round"/>
                            </svg>
                        </span>
                        <span class="group-name">Triangle</span>
                        <span class="group-description">3 persone</span>
                    </div>
                    <div class="group-meta">
                        <span class="group-count-badge">{{ catene_3|length }} catene</span>
                        <i class="fas fa-chevron-down chevron-icon"></i>
                    </div>
                </button>
                <div id="group-3" class="chain-group-content">
                    {% for catena in catene_3 %}
                    {% include "scambi/partials/mie_catene_card.html" %}
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Gruppo 4 persone - Square -->
            {% if catene_4 %}
            <div class="chain-group mb-4">
                <button class="chain-group-header" onclick="toggleGroup('group-4')">
                    <div class="group-title">
                        <span class="group-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <rect x="4" y="4" width="16" height="16" stroke="#4169E1" stroke-width="2" fill="none" stroke-linejoin="round"/>
                            </svg>
                        </span>
                        <span class="group-name">Square</span>
                        <span class="group-description">4 persone</span>
                    </div>
                    <div class="group-meta">
                        <span class="group-count-badge">{{ catene_4|length }} catene</span>
                        <i class="fas fa-chevron-down chevron-icon"></i>
                    </div>
                </button>
                <div id="group-4" class="chain-group-content">
                    {% for catena in catene_4 %}
                    {% include "scambi/partials/mie_catene_card.html" %}
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Gruppo 5 persone - Pentagon -->
            {% if catene_5 %}
            <div class="chain-group mb-4">
                <button class="chain-group-header" onclick="toggleGroup('group-5')">
                    <div class="group-title">
                        <span class="group-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 3 L21 9 L18 19 L6 19 L3 9 Z" stroke="#4169E1" stroke-width="2" fill="none" stroke-linejoin="round"/>
                            </svg>
                        </span>
                        <span class="group-name">Pentagon</span>
                        <span class="group-description">5 persone</span>
                    </div>
                    <div class="group-meta">
                        <span class="group-count-badge">{{ catene_5|length }} catene</span>
                        <i class="fas fa-chevron-down chevron-icon"></i>
                    </div>
                </button>
                <div id="group-5" class="chain-group-content">
                    {% for catena in catene_5 %}
                    {% include "scambi/partials/mie_catene_card.html" %}
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Gruppo 6 persone - Hexagon -->
            {% if catene_6 %}
            <div class="chain-group mb-4">
                <button class="chain-group-header" onclick="toggleGroup('group-6')">
                    <div class="group-title">
                        <span class="group-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 2 L20 7 L20 17 L12 22 L4 17 L4 7 Z" stroke="#4169E1" stroke-width="2" fill="none" stroke-linejoin="round"/>
                            </svg>
                        </span>
                        <span class="group-name">Hexagon</span>
                        <span class="group-description">6 persone</span>
                    </div>
                    <div class="group-meta">
                        <span class="group-count-badge">{{ catene_6|length }} catene</span>
                        <i class="fas fa-chevron-down chevron-icon"></i>
                    </div>
                </button>
                <div id="group-6" class="chain-group-content">
                    {% for catena in catene_6 %}
                    {% include "scambi/partials/mie_catene_card.html" %}
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>
        {% endif %}

        <!-- Torna alle catene -->
        <div class="text-center mt-4">
            <a href="{% url 'catene_scambio' %}?load=true" class="btn btn-lg btn-primary">
                <i class="fas fa-search me-2"></i>Esplora Altre Catene
            </a>
        </div>
    </div>
</div>

<script>
// Funzione per espandere/contrarre i gruppi
function toggleGroup(groupId) {
    const content = document.getElementById(groupId);
    const header = event.target.closest('.chain-group-header');
    const chevron = header.querySelector('.chevron-icon');
    const group = header.closest('.chain-group');

    if (content.style.maxHeight && content.style.maxHeight !== '0px') {
        // Close
        content.style.maxHeight = '0px';
        chevron.style.transform = 'rotate(0deg)';
        group.classList.remove('expanded');
    } else {
        // Open
        content.style.maxHeight = content.scrollHeight + 'px';
        chevron.style.transform = 'rotate(180deg)';
        group.classList.add('expanded');
    }
}
</script>

<link rel="stylesheet" href="{% static 'css/catene_scambio.css' %}">
{% endblock %}
